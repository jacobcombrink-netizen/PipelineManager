{% extends "base.html" %}
{% block title %}Projects ‚Äî Pipeline Manager{% endblock %}
{% block content %}
<div class="mb-8 flex items-center justify-between">
  <div>
    <h1 class="text-2xl font-bold text-slate-100">Projects</h1>
    <p class="text-slate-500 text-sm mt-1">Projects group render jobs, prompts and media into a campaign. They eventually become a Top Layer composite.</p>
  </div>
  <button onclick="openModal('add-project-modal')" class="btn btn-primary">Ôºã New Project</button>
</div>

{% if items %}
<div class="grid grid-cols-2 gap-4">
  {% for item in items %}
  <div class="card hover:border-slate-700 transition-colors">
    <div class="flex items-start justify-between gap-3 mb-3">
      <div>
        <div class="flex items-center gap-2 mb-1">
          <span class="text-slate-100 font-semibold text-lg">{{ item.name }}</span>
          {% if item.status == 'active' %}<span class="badge badge-green">Active</span>
          {% elif item.status == 'complete' %}<span class="badge badge-teal">Complete</span>
          {% else %}<span class="badge badge-grey">{{ item.status|title }}</span>{% endif %}
        </div>
        {% if item.description %}<p class="text-slate-400 text-sm">{{ item.description }}</p>{% endif %}
      </div>
      <div class="flex gap-1.5 flex-shrink-0">
        <button onclick="openEditProject({{ item.id }}, '{{ item.name|e }}', `{{ item.description|e }}`, '{{ item.status }}', `{{ item.notes|e }}`)" class="btn btn-sm btn-ghost">Edit</button>
        <form method="POST" action="/projects/delete/{{ item.id }}" onsubmit="return confirm('Delete project and its prompts?')">
          <button type="submit" class="btn btn-sm btn-danger">Delete</button>
        </form>
      </div>
    </div>
    <div class="flex gap-4 mb-3">
      <div class="text-center">
        <div class="text-xl font-bold text-blue-400">{{ item.job_count }}</div>
        <div class="text-slate-500 text-xs">Jobs</div>
      </div>
      <div class="text-center">
        <div class="text-xl font-bold text-violet-400">{{ item.prompt_count }}</div>
        <div class="text-slate-500 text-xs">Prompts</div>
      </div>
    </div>
    <a href="/journal?project_id={{ item.id }}" class="btn btn-secondary w-full block text-center text-sm">üìù Open Journal ‚Üí</a>
  </div>
  {% endfor %}
</div>
{% else %}
<div class="card text-slate-500 text-sm">No projects yet. Create one to start grouping your work.</div>
{% endif %}

<dialog id="add-project-modal">
  <div class="modal-header">
    <span class="font-semibold text-slate-100">New Project</span>
    <button onclick="closeModal('add-project-modal')" class="text-slate-500 hover:text-slate-300 text-xl">√ó</button>
  </div>
  <form method="POST" action="/projects/add">
    <div class="modal-body space-y-3">
      <div><label>Name *</label><input class="input" name="name" required placeholder="e.g. Character Launch Campaign"></div>
      <div><label>Description</label><textarea class="input" name="description" rows="2" placeholder="What is this project working towards?"></textarea></div>
      <div><label>Status</label>
        <select class="input" name="status">
          <option value="active">Active</option>
          <option value="paused">Paused</option>
          <option value="complete">Complete</option>
        </select>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" onclick="closeModal('add-project-modal')" class="btn btn-ghost">Cancel</button>
      <button type="submit" class="btn btn-primary">Create Project</button>
    </div>
  </form>
</dialog>

<dialog id="edit-project-modal">
  <div class="modal-header">
    <span class="font-semibold text-slate-100">Edit Project</span>
    <button onclick="closeModal('edit-project-modal')" class="text-slate-500 hover:text-slate-300 text-xl">√ó</button>
  </div>
  <form id="edit-project-form" method="POST">
    <div class="modal-body space-y-3">
      <div><label>Name *</label><input class="input" id="ep-name" name="name" required></div>
      <div><label>Description</label><textarea class="input" id="ep-desc" name="description" rows="2"></textarea></div>
      <div><label>Status</label>
        <select class="input" id="ep-status" name="status">
          <option value="active">Active</option><option value="paused">Paused</option><option value="complete">Complete</option>
        </select>
      </div>
      <div><label>Notes</label><textarea class="input" id="ep-notes" name="notes" rows="3"></textarea></div>
    </div>
    <div class="modal-footer">
      <button type="button" onclick="closeModal('edit-project-modal')" class="btn btn-ghost">Cancel</button>
      <button type="submit" class="btn btn-primary">Save</button>
    </div>
  </form>
</dialog>

<script>
function openEditProject(id, name, desc, status, notes) {
  document.getElementById('edit-project-form').action = '/projects/edit/' + id;
  document.getElementById('ep-name').value = name;
  document.getElementById('ep-desc').value = desc;
  document.getElementById('ep-status').value = status;
  document.getElementById('ep-notes').value = notes;
  openModal('edit-project-modal');
}
</script>
{% endblock %}
